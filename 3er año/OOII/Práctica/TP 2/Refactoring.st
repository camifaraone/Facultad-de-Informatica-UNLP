Object subclass: #Answer	instanceVariableNames: 'question timestamp user votes description'	classVariableNames: ''	package: 'TP-Refactoring-Model'!!Answer methodsFor: 'accessing'!description	^ description! !!Answer methodsFor: 'accessing'!timestamp	^ timestamp! !!Answer methodsFor: 'accessing'!user	^ user! !!Answer methodsFor: 'accessing'!votes	^ votes! !!Answer methodsFor: 'accessing'!isTopAnswer	.	^ self positiveVotes >=  ((question sum: [:answer | answer positiveVotes size ]) / question answer size )! !!Answer methodsFor: 'private'!user: anObject	user := anObject! !!Answer methodsFor: 'private'!description: anObject	description := anObject! !!Answer methodsFor: 'private'!question: aQuestion	question := aQuestion ! !!Answer methodsFor: 'private'!timestamp: anObject	timestamp := anObject! !!Answer methodsFor: 'initialize'!initialize	votes := OrderedCollection new.	timestamp := DateAndTime now.! !!Answer methodsFor: 'as yet unclassified'!negativeVotes	| r |	r := OrderedCollection new.	votes do:[:vote | vote isLike ifFalse:[r add: vote]].	^r! !!Answer methodsFor: 'as yet unclassified'!positiveVotes	| r |	r := OrderedCollection new.	votes do:[:vote | vote isLike ifTrue:[r add: vote]].	^r! !!Answer methodsFor: 'adding'!addVote: aVote	votes add: aVote! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Answer class	instanceVariableNames: ''!!Answer class methodsFor: 'instance creation'!new: anAnswer user: aUser question: aQuestion	^ self new		description: anAnswer;		user: aUser;		question: aQuestion;		yourself! !Object subclass: #CuOOra	instanceVariableNames: 'users topics questions'	classVariableNames: ''	package: 'TP-Refactoring-Model'!!CuOOra methodsFor: 'initialize'!initialize	users := OrderedCollection new.	topics := OrderedCollection new.	questions := OrderedCollection new! !!CuOOra methodsFor: 'adding'!addQuestion: aQuestion	questions add: aQuestion! !!CuOOra methodsFor: 'adding'!addUser: aUser	users add: aUser ! !!CuOOra methodsFor: 'adding'!addTopic: aTopic	topics add: aTopic ! !!CuOOra methodsFor: 'adding'!addQuestion: aQuestion forUser: aUser	aUser addQuestion: aQuestion.	questions add: aQuestion.! !!CuOOra methodsFor: 'accessing'!users	^ users! !!CuOOra methodsFor: 'accessing'!questions	^ questions! !!CuOOra methodsFor: 'accessing'!topics	^ topics! !Object subclass: #Question	instanceVariableNames: 'title answers topics timestamp user votes description'	classVariableNames: ''	package: 'TP-Refactoring-Model'!!Question methodsFor: 'accessing'!description	^ description! !!Question methodsFor: 'accessing'!timestamp	^ timestamp! !!Question methodsFor: 'accessing'!topics	^topics ! !!Question methodsFor: 'accessing'!title	^title ! !!Question methodsFor: 'accessing'!user	^ user! !!Question methodsFor: 'accessing'!title: aTitle	title := aTitle ! !!Question methodsFor: 'accessing'!votes	^ votes! !!Question methodsFor: 'private'!user: anObject	user := anObject! !!Question methodsFor: 'private'!description: anObject	description := anObject! !!Question methodsFor: 'private'!timestamp: anObject	timestamp := anObject! !!Question methodsFor: 'adding'!addVote: aVote	votes add: aVote! !!Question methodsFor: 'adding'!addTopic: aTopic	topics add: aTopic.	aTopic addQuestion: self.! !!Question methodsFor: 'as yet unclassified'!negativeVotes	| r |	r := OrderedCollection new.	votes do:[:vote | vote isLike ifFalse:[r add: vote]].	^r! !!Question methodsFor: 'as yet unclassified'!positiveVotes	| r |	r := OrderedCollection new.	votes do:[:vote | vote isLike ifTrue:[r add: vote]].	^r! !!Question methodsFor: 'initalize-release'!initialize	answers := OrderedCollection new.	topics := OrderedCollection new.	votes := OrderedCollection new.	timestamp := DateAndTime now.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Question class	instanceVariableNames: ''!!Question class methodsFor: 'instance creation'!newWithTitle: title description: aDescription user: aUser	^ self new		title: title;		description: aDescription;		user: aUser;		yourself.! !!Question class methodsFor: 'instance creation'!newWithTitle: title description: aDescription user: aUser topic: aTopic	^ self new		title: title;		description: aDescription;		addTopic: aTopic;		user: aUser;		yourself.! !Object subclass: #QuestionRetriever	instanceVariableNames: 'option cuoora'	classVariableNames: ''	package: 'TP-Refactoring-Model'!!QuestionRetriever methodsFor: 'initializing'!initialize	option := #social! !!QuestionRetriever methodsFor: 'retrieving'!retrieveQuestions: aUser	| qRet temp followingCol topicsCol newsCol popularTCol averageVotes|	qRet := OrderedCollection new.	option = #social ifTrue:[			followingCol := OrderedCollection new.			aUser following do:[ :follow | followingCol addAll: follow questions ].			temp := followingCol asSortedCollection:[ :a :b | a positiveVotes size > b positiveVotes size ].			qRet := temp last: (100 min: temp size).		].	option = #topics ifTrue:[			topicsCol := OrderedCollection new.			aUser topics do:[ :topic | topicsCol addAll: topic questions ].			temp := topicsCol asSortedCollection:[ :a :b | a positiveVotes size > b positiveVotes size ].			qRet := temp last: (100 min: temp size).		].		option = #news ifTrue:[			newsCol := OrderedCollection new.			cuoora questions do:[:q | (q timestamp asDate = Date today) ifTrue: [newsCol add: q]].			temp := newsCol asSortedCollection:[ :a :b | a positiveVotes size > b positiveVotes size ].			qRet := temp last: (100 min: temp size).		].	option = #popularToday ifTrue:[			popularTCol := OrderedCollection new.			cuoora questions do:[:q | (q timestamp asDate = Date today) ifTrue: [popularTCol add: q]].			averageVotes := (cuoora questions sum: [:q | q positiveVotes size ]) / popularTCol size.			temp := (popularTCol select:[:q | q positiveVotes size >= averageVotes ]) asSortedCollection:[ :a :b | a positiveVotes size > b positiveVotes size ].			qRet := temp last: (100 min: temp size).		].		^qRet reject:[:q | q user = aUser].! !!QuestionRetriever methodsFor: 'accesing'!option: anOption	option := anOption! !!QuestionRetriever methodsFor: 'accesing'!cuoora: aCuooraInstance	cuoora := aCuooraInstance ! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!QuestionRetriever class	instanceVariableNames: ''!!QuestionRetriever class methodsFor: 'instance creation'!new: cuoora	^ self new cuoora: cuoora! !!QuestionRetriever class methodsFor: 'instance creation'!new: cuoora and: aSymbol	^ self new cuoora: cuoora; option:aSymbol; yourself.! !Object subclass: #Topic	instanceVariableNames: 'name description questions'	classVariableNames: ''	package: 'TP-Refactoring-Model'!!Topic methodsFor: 'accessing'!description	^ description! !!Topic methodsFor: 'accessing'!questions	^ questions! !!Topic methodsFor: 'accessing'!name	^name! !!Topic methodsFor: 'accessing'!addQuestion: aQuetion	questions add: aQuetion ! !!Topic methodsFor: 'accessing'!description: anObject	description := anObject! !!Topic methodsFor: 'accessing'!name: anObject	name := anObject! !!Topic methodsFor: 'initialize'!initialize	questions := OrderedCollection new.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Topic class	instanceVariableNames: ''!!Topic class methodsFor: 'intance creation'!name: aName description: aDescription	^ self new		name: aName;		description: aDescription;		yourself! !Object subclass: #User	instanceVariableNames: 'questionRetriever questions answers username password topics following votes'	classVariableNames: ''	package: 'TP-Refactoring-Model'!!User methodsFor: 'accessing'!following	^ following! !!User methodsFor: 'accessing'!password	^ password! !!User methodsFor: 'accessing'!topics	^ topics! !!User methodsFor: 'accessing'!votes	^ votes! !!User methodsFor: 'accessing'!addAnswer: anAnswer	answers add: anAnswer ! !!User methodsFor: 'accessing'!addVote: aVote	votes add: aVote! !!User methodsFor: 'accessing'!addTopic: aTopic	topics add: aTopic ! !!User methodsFor: 'accessing'!questions	^ questions! !!User methodsFor: 'accessing'!username	^ username! !!User methodsFor: 'accessing'!addQuestion: aQuestion	questions add: aQuestion! !!User methodsFor: 'accessing'!questionsOfInterest	^ questionRetriever retrieveQuestions: self.! !!User methodsFor: 'accessing'!questionRetriever	^ questionRetriever! !!User methodsFor: 'accessing'!answers	^ answers! !!User methodsFor: 'accessing'!follow: aUser	following add: aUser ! !!User methodsFor: 'private'!questionRetriever: aQuestionRetriever	questionRetriever := aQuestionRetriever.! !!User methodsFor: 'private'!password: anObject	password := anObject! !!User methodsFor: 'private'!username: anObject	username := anObject! !!User methodsFor: 'initialize'!initialize	questions := OrderedCollection new.  	answers := OrderedCollection new. 	topics := OrderedCollection new. 	following := OrderedCollection new. 	votes := OrderedCollection new.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!User class	instanceVariableNames: ''!!User class methodsFor: 'instance-creation'!username: aUsername password: aPassword questionRetriever: aQuestionRetriever	^ self new		username: aUsername;		password: aPassword;		questionRetriever: aQuestionRetriever;		yourself! !Object subclass: #Vote	instanceVariableNames: 'isLike timstamp publication user'	classVariableNames: ''	package: 'TP-Refactoring-Model'!!Vote methodsFor: 'initialize'!initialize	isLike := true.	timstamp := DateAndTime now.	! !!Vote methodsFor: 'private'!user: anObject	user := anObject! !!Vote methodsFor: 'private'!like	isLike := true.! !!Vote methodsFor: 'private'!dislike	isLike := false.! !!Vote methodsFor: 'private'!publication: anObject	publication := anObject! !!Vote methodsFor: 'accessing'!publication	^ publication! !!Vote methodsFor: 'accessing'!isLike	^ isLike! !!Vote methodsFor: 'accessing'!user	^ user! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Vote class	instanceVariableNames: ''!!Vote class methodsFor: 'instance creation'!user: aUser likesPublication: aPublication	^ self new		user: aUser;		publication: aPublication;		yourself! !!Vote class methodsFor: 'instance creation'!user: aUser dislikesPublication: aPublication	^ self new		user: aUser;		publication: aPublication;		dislike;		yourself! !TestCase subclass: #AnswerTest	instanceVariableNames: 'answer'	classVariableNames: ''	package: 'TP-Refactoring-Tests'!!AnswerTest methodsFor: 'testing'!testVotesForNewAnswer	self assert: (answer negativeVotes size) equals: 0.	self assert: (answer positiveVotes size) equals: 0.		! !!AnswerTest methodsFor: 'testing'!testPositiveVotes	answer addVote: (Vote user: (User new) likesPublication: answer).		self assert: (answer positiveVotes size) equals: 1.		answer addVote: (Vote user: (User new) likesPublication: answer).		self assert: (answer positiveVotes size) equals: 2.	! !!AnswerTest methodsFor: 'testing'!testNegativeVotes			answer addVote: (Vote user: (User new) dislikesPublication: answer).	self assert: (answer negativeVotes size) equals: 1.		answer addVote: (Vote user: (User new) dislikesPublication: answer).	self assert: (answer negativeVotes size) equals: 2.! !!AnswerTest methodsFor: 'testing'!testPositiveAndNegativeVotesInterference		answer addVote: (Vote user: (User new) dislikesPublication: answer).	self assert: (answer positiveVotes size) equals: 0.		answer addVote: (Vote user: (User new) likesPublication: answer).		self assert: (answer positiveVotes size) equals: 1.		answer addVote: (Vote user: (User new) likesPublication: answer).		self assert: (answer positiveVotes size) equals: 2.		answer addVote: (Vote user: (User new) dislikesPublication: answer).	self assert: (answer positiveVotes size) equals: 2.		self assert: answer votes size equals: 4.! !!AnswerTest methodsFor: 'setup'!setUp	answer := Answer new:'An answer'  user:(User new)  question:(Question new).! !TestCase subclass: #QuestionRetrieverTest	instanceVariableNames: 'cuoora socialRetriever topicsRetriever newsRetriever popularTodayRetriever user1 user2 user3 topicOO1 topicOO2 questionUser1TopicOO1 questionUser3TopicOO2 questionUser2TopicOO2 question2User3TopicOO2'	classVariableNames: ''	package: 'TP-Refactoring-Tests'!!QuestionRetrieverTest methodsFor: 'set up'!setUp	user1 := User new.	user2 := User new.	user3 := User new.	user1 follow: user2; follow: user3.		topicOO1 := Topic name: 'OO1' description: 'This topic is for discussing about OO1 issues'.	topicOO2 := Topic name: 'OO2' description: 'This topic is for discussing about OO2 issues'.		user1 addTopic: topicOO1.	user2 addTopic: topicOO2.	user3 addTopic: topicOO2.	cuoora := CuOOra new.	cuoora addUser: user1; addUser: user2; addUser: user3.		questionUser1TopicOO1 := Question newWithTitle: 'How to create a class in Pharo' description: '' user: user1 topic: topicOO1.	questionUser3TopicOO2 := Question newWithTitle: 'How to create a WAComponent for...' description: '' user: user3 topic: topicOO2.	cuoora addQuestion: questionUser1TopicOO1 forUser:user1.	cuoora addQuestion: questionUser3TopicOO2 forUser:user3.		socialRetriever := QuestionRetriever new: cuoora and: #social.	topicsRetriever := QuestionRetriever new: cuoora and: #topics.	newsRetriever := QuestionRetriever new: cuoora and: #news.	popularTodayRetriever := QuestionRetriever new: cuoora and: #popularToday.! !!QuestionRetrieverTest methodsFor: 'testing'!popularTodayNoLikesThreeQuestions  "0 likes / 3 preguntas "  questionUser2TopicOO2 := Question newWithTitle: 'Which bad smell...?' description: '' user: user2 topic: topicOO2.  cuoora addQuestion: questionUser2TopicOO2 forUser: user2.  self assert: (popularTodayRetriever retrieveQuestions: user1) size equals: 2.  self assert: (popularTodayRetriever retrieveQuestions: user2) size equals: 2.  self assert: (popularTodayRetriever retrieveQuestions: user3) size equals: 2! !!QuestionRetrieverTest methodsFor: 'testing'!popularTodayFourQuestionsAtLeastOneVote	  "1 likes / 4 preguntas // preguntas con al menos 1 voto"question2User3TopicOO2 := Question newWithTitle: 'Which refactoring should...' description: '' user: user3 topic: topicOO2.  cuoora addQuestion: question2User3TopicOO2 forUser: user3.  self assert: (popularTodayRetriever retrieveQuestions: user1) size equals: 1.  self assert: (popularTodayRetriever retrieveQuestions: user2) size equals: 0.  self assert: (popularTodayRetriever retrieveQuestions: user3) size equals: 1.! !!QuestionRetrieverTest methodsFor: 'testing'!popularTodayAtLeastOneVote   "1 likes / 2 preguntas // preguntas con al menos 1 voto"  questionUser2TopicOO2 addVote: (Vote user: user3 likesPublication: questionUser2TopicOO2).  self assert: (popularTodayRetriever retrieveQuestions: user1) size equals: 1.  self assert: (popularTodayRetriever retrieveQuestions: user2) size equals: 0.  self assert: (popularTodayRetriever retrieveQuestions: user3) size equals: 1! !!QuestionRetrieverTest methodsFor: 'testing'!popularTodayFiveLikesFourQuestionsAtLeastOneVote  "5 likes / 4 preguntas // preguntas con mas de 1 voto"question2User3TopicOO2 addVote: (Vote user: User new likesPublication: question2User3TopicOO2).  self assert: (popularTodayRetriever retrieveQuestions: user1) size equals: 1.  self assert: (popularTodayRetriever retrieveQuestions: user1) first equals: question2User3TopicOO2.  self assert: (popularTodayRetriever retrieveQuestions: user2) size equals: 1.  self assert: (popularTodayRetriever retrieveQuestions: user3) size equals: 0.  15 timesRepeat: [ questionUser1TopicOO1 addVote: (Vote user: User new likesPublication: questionUser1TopicOO1) ].  self assert: (popularTodayRetriever retrieveQuestions: user1) size equals: 0.  self assert: (popularTodayRetriever retrieveQuestions: user2) size equals: 1.  self assert: (popularTodayRetriever retrieveQuestions: user2) first equals: questionUser1TopicOO1.  self assert: (popularTodayRetriever retrieveQuestions: user3) size equals: 1.  self assert: (popularTodayRetriever retrieveQuestions: user3) first equals: questionUser1TopicOO1! !!QuestionRetrieverTest methodsFor: 'testing'!testPopularTodayRetrieveQuestions  self     popularTodayNoLikesTwoQuestions;     popularTodayNoLikesThreeQuestions;     popularTodayAtLeastOneVote;     popularTodayFourQuestionsAtLeastOneVote;     popularTodayTwoLikesFourQuestionsAtLeastOneVote;     popularTodayFourLikesFourQuestionsAtLeastOneVote;     popularTodayFiveLikesFourQuestionsAtLeastOneVote! !!QuestionRetrieverTest methodsFor: 'testing'!popularTodayFourLikesFourQuestionsAtLeastOneVote	  "4 likes / 4 preguntas // preguntas con al menos 1 voto"question2User3TopicOO2 addVote: (Vote user: user1 likesPublication: question2User3TopicOO2).  question2User3TopicOO2 addVote: (Vote user: User new likesPublication: question2User3TopicOO2).  self assert: (popularTodayRetriever retrieveQuestions: user1) size equals: 2.  self assert: (popularTodayRetriever retrieveQuestions: user2) size equals: 1.  self assert: (popularTodayRetriever retrieveQuestions: user3) size equals: 1.! !!QuestionRetrieverTest methodsFor: 'testing'!testSocialRetrieveQuestions	| questionUser2TopicOO2 |		self assert: (socialRetriever retrieveQuestions: user1) size equals: 1.	self assert: (socialRetriever retrieveQuestions: user1) first equals: questionUser3TopicOO2.		self assert: (socialRetriever retrieveQuestions: user2) size equals: 0.	self assert: (socialRetriever retrieveQuestions: user3) size equals: 0.		questionUser2TopicOO2 := Question newWithTitle: 'Which bad smell...?' description: '' user: user2 topic: topicOO2.	questionUser2TopicOO2 addVote: (Vote user: user2 dislikesPublication: questionUser2TopicOO2).	cuoora addQuestion: questionUser2TopicOO2 forUser:user2.		self assert: (socialRetriever retrieveQuestions: user1) size equals: 2.	self assert: (socialRetriever retrieveQuestions: user1) last equals: questionUser2TopicOO2.		self assert: (socialRetriever retrieveQuestions: user3) size equals: 0.	self assert: (socialRetriever retrieveQuestions: user2) size equals: 0.				! !!QuestionRetrieverTest methodsFor: 'testing'!popularTodayNoLikesTwoQuestions	self		assert: (popularTodayRetriever retrieveQuestions: user1) size		equals: 1.	"0 likes / 2 preguntas "	self		assert: (popularTodayRetriever retrieveQuestions: user1) last		equals: questionUser3TopicOO2.	self		assert: (popularTodayRetriever retrieveQuestions: user2) size		equals: 2.	self		assert: (popularTodayRetriever retrieveQuestions: user3) size		equals: 1.	self		assert: (popularTodayRetriever retrieveQuestions: user3) last		equals: questionUser1TopicOO1! !!QuestionRetrieverTest methodsFor: 'testing'!testNewsRetrieveQuestions	| questionUser2TopicOO2 |	self assert: (newsRetriever retrieveQuestions: user1) size equals: 1.	self assert: (newsRetriever retrieveQuestions: user1) last equals: questionUser3TopicOO2.	self assert: (newsRetriever retrieveQuestions: user2) size equals: 2.	self assert: (newsRetriever retrieveQuestions: user3) size equals: 1.	self assert: (newsRetriever retrieveQuestions: user3) last equals: questionUser1TopicOO1.		questionUser2TopicOO2 := Question		newWithTitle: 'Which bad smell...?'		description: ''		user: user2		topic: topicOO2.	cuoora addQuestion: questionUser2TopicOO2 forUser: user2.		self assert: (newsRetriever retrieveQuestions: user1) size equals: 2.	self assert: (newsRetriever retrieveQuestions: user2) size equals: 2.	self assert: (newsRetriever retrieveQuestions: user3) size equals: 2.! !!QuestionRetrieverTest methodsFor: 'testing'!testTopicsRetrieveQuestions  | questionUser2TopicOO2 |  self assert: (topicsRetriever retrieveQuestions: user1) size equals: 0.  self assert: (topicsRetriever retrieveQuestions: user2) size equals: 1.  self assert: (topicsRetriever retrieveQuestions: user3) size equals: 0.  questionUser2TopicOO2 := Question newWithTitle: 'Which bad smell...?' description: '' user: user2 topic: topicOO2.  cuoora addQuestion: questionUser2TopicOO2 forUser: user2.  self assert: (topicsRetriever retrieveQuestions: user2) size equals: 1.  self assert: (topicsRetriever retrieveQuestions: user3) size equals: 1.  self assert: (topicsRetriever retrieveQuestions: user3) first equals: questionUser2TopicOO2.  self assert: (topicsRetriever retrieveQuestions: user1) size equals: 0! !!QuestionRetrieverTest methodsFor: 'testing'!popularTodayTwoLikesFourQuestionsAtLeastOneVote	   "2 likes / 4 preguntas // preguntas con al menos 1 voto"question2User3TopicOO2 addVote: (Vote user: user2 likesPublication: question2User3TopicOO2).  self assert: (popularTodayRetriever retrieveQuestions: user1) size equals: 2.  self assert: (popularTodayRetriever retrieveQuestions: user2) size equals: 1.  self assert: (popularTodayRetriever retrieveQuestions: user3) size equals: 1.! !TestCase subclass: #QuestionTest	instanceVariableNames: 'question'	classVariableNames: ''	package: 'TP-Refactoring-Tests'!!QuestionTest methodsFor: 'testing'!testPositiveVotes	question addVote: (Vote user: (User new) likesPublication: question).		self assert: (question positiveVotes size) equals: 1.		question addVote: (Vote user: (User new) likesPublication: question).		self assert: (question positiveVotes size) equals: 2.	! !!QuestionTest methodsFor: 'testing'!testNegativeVotes			question addVote: (Vote user: (User new) dislikesPublication: question).	self assert: (question negativeVotes size) equals: 1.		question addVote: (Vote user: (User new) dislikesPublication: question).	self assert: (question negativeVotes size) equals: 2.! !!QuestionTest methodsFor: 'testing'!testPositiveAndNegativeVotesInterference		question addVote: (Vote user: (User new) dislikesPublication: question).	self assert: (question positiveVotes size) equals: 0.	self assert: (question negativeVotes size) equals: 1.		question addVote: (Vote user: (User new) likesPublication: question).		self assert: (question positiveVotes size) equals: 1.	self assert: (question negativeVotes size) equals: 1.		self assert: question votes size equals: 2.! !!QuestionTest methodsFor: 'testing'!testVotesForNewQuestion	self assert: (question negativeVotes size) equals: 0.	self assert: (question positiveVotes size) equals: 0.		! !!QuestionTest methodsFor: 'setup'!setUp	question := Question  newWithTitle: 'Question  title' description: 'Question description' user: (User new) ! !